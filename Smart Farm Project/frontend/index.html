<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/x-icon" href="favicon"/>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <title>ESP32 Web Server</title>
</head>
<body>
  <div class="container">
    <div class="navbar">
      <img src="logo" class="logo">
      <nav>
        <h3>ESP32 Web Server</h3>
        <h6>Веб-интерфейс мониторинга и конфигурирования</h6>
      </nav>
    </div>

    <div class="card-container">
      <div class="card">
        <label class="card-title">Мониторинг микроклиматических параметров</label>
        <div class="card-body">
          <div class="card-body-item">
            <img src="temperature" class="stats-logo">
            <div class="item-title">Температура воздуха: </div>
            <div id="temperaturevalue" class="item-value">%TEMPERATURE%</div>
            <sup class="units">&deg;C</sup>
          </div>
          <div class="card-body-item">
            <img src="pressure" class="stats-logo">
            <div class="item-title">Атмосферное давление: </div>
            <div id="pressurevalue" class="item-value">%PRESSURE%</div>
            <div class="pressure-unit">
              <span>мм</span>
              <span>рт.</span>
              <span>ст.</span>
            </div>
          </div>
          <div class="card-body-item">
            <img src="soil" class="stats-logo">
            <div class="item-title">Влажность почвы: </div>
            <div id="moisturevalue" class="item-value">%MOISTURE%</div>
            <sup class="units">&#37;</sup>
          </div>
        </div>
      </div>
      <div class="card">
        <label class="card-title">Конфигурирование устройств управления микроклиматом</label>
        <label class="card-title"></label>
        <div class="card-body">
          <div class="card-body-item">
            <img src="light" class="stats-logo">
            <div class="item-title">Включить освещение</div>
            <label class="switch">
              <input type="checkbox" id="lighting_switch">
              <span class="slider round"></span>
            </label>
          </div>
          <div class="card-body-item">
            <img src="watering" class="stats-logo">
            <div class="item-title">Включить полив</div>
            <label class="switch">
              <input type="checkbox" id="watering_switch">
              <span class="slider round"></span>
            </label>
          </div>
          <div class="card-body-item">
            <img src="fan" class="stats-logo">
            <div class="item-title">Включить вентиляцию</div>
            <label class="switch">
              <input type="checkbox" id="ventilation_switch">
              <span class="slider round"></span>
            </label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    setInterval(function() {
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          document.getElementById("temperaturevalue").innerHTML = this.responseText;
        }
      };
      xhttp.open("GET", "/gettemperature", true);
      xhttp.send();
    }, 5000);

    setInterval(function() {
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          document.getElementById("pressurevalue").innerHTML = this.responseText;
        }
      };
      xhttp.open("GET", "/getpressure", true);
      xhttp.send();
    }, 5000);

    setInterval(function() {
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          document.getElementById("moisturevalue").innerHTML = this.responseText;
        }
      };
      xhttp.open("GET", "/getmoisture", true);
      xhttp.send();
    }, 5000);

    var lightingSwitch = document.getElementById("lighting_switch");
    lightingSwitch.addEventListener('change', function () {
      var xhttp = new XMLHttpRequest();
      xhttp.open("GET", "/switchlighting", true);
      xhttp.send();
    });

    var wateringSwitch = document.getElementById("watering_switch");
    wateringSwitch.addEventListener('change', function () {
      var xhttp = new XMLHttpRequest();
      xhttp.open("GET", "/switchwatering", true);
      xhttp.send();
    });

    var ventilationSwitch = document.getElementById("ventilation_switch");
    ventilationSwitch.addEventListener('change', function () {
      var xhttp = new XMLHttpRequest();
      xhttp.open("GET", "/switchventilation", true);
      xhttp.send();
    });

  </script>

</body>
</html>